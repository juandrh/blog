<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Guía rápida de Machine Learning con Python | Juan del Río</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Guía rápida de Machine Learning con Python" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Guía de referencia rápida de aprendizaje automático con Python" />
<meta property="og:description" content="Guía de referencia rápida de aprendizaje automático con Python" />
<link rel="canonical" href="https://juandrh.github.io/blog/python/kaggle/ml/2021/08/16/Machine-Learning-con-Python.html" />
<meta property="og:url" content="https://juandrh.github.io/blog/python/kaggle/ml/2021/08/16/Machine-Learning-con-Python.html" />
<meta property="og:site_name" content="Juan del Río" />
<meta property="og:image" content="https://juandrh.github.io/blog/images/python.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-08-16T00:00:00-05:00" />
<script type="application/ld+json">
{"url":"https://juandrh.github.io/blog/python/kaggle/ml/2021/08/16/Machine-Learning-con-Python.html","@type":"BlogPosting","headline":"Guía rápida de Machine Learning con Python","dateModified":"2021-08-16T00:00:00-05:00","datePublished":"2021-08-16T00:00:00-05:00","image":"https://juandrh.github.io/blog/images/python.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://juandrh.github.io/blog/python/kaggle/ml/2021/08/16/Machine-Learning-con-Python.html"},"description":"Guía de referencia rápida de aprendizaje automático con Python","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/blog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://juandrh.github.io/blog/feed.xml" title="Juan del Río" /><link rel="shortcut icon" type="image/x-icon" href="/blog/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/blog/">Juan del Río</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/blog/about/">About Me</a><a class="page-link" href="/blog/search/">Search</a><a class="page-link" href="/blog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Guía rápida de Machine Learning con Python</h1><p class="page-description">Guía de referencia rápida de aprendizaje automático con Python</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-08-16T00:00:00-05:00" itemprop="datePublished">
        Aug 16, 2021
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      16 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/blog/categories/#python">python</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#kaggle">kaggle</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#ML">ML</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/juandrh/blog/tree/master/_notebooks/2021-08-16-Machine-Learning-con-Python.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/blog/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/juandrh/blog/master?filepath=_notebooks%2F2021-08-16-Machine-Learning-con-Python.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/blog/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/juandrh/blog/blob/master/_notebooks/2021-08-16-Machine-Learning-con-Python.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/blog/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#Introducción">Introducción </a></li>
<li class="toc-entry toc-h1"><a href="#Los-pasos-a-seguir-para-obtener-un-software-de-aprendizaje-automático-son:">Los pasos a seguir para obtener un software de aprendizaje automático son: </a>
<ul>
<li class="toc-entry toc-h2"><a href="#1---Recoger-los-datos">1 - Recoger los datos </a></li>
<li class="toc-entry toc-h2"><a href="#2---Preparar-los-datos">2 - Preparar los datos </a>
<ul>
<li class="toc-entry toc-h3"><a href="#2.1---Exploración-de-los-datos">2.1 - Exploración de los datos </a></li>
<li class="toc-entry toc-h3"><a href="#2.2--Tratamiento-de-valores-que-faltan">2.2- Tratamiento de valores que faltan </a>
<ul>
<li class="toc-entry toc-h4"><a href="#2.2.1---Eliminar-columna">2.2.1 - Eliminar columna </a></li>
<li class="toc-entry toc-h4"><a href="#2.2.2---Imputación">2.2.2 - Imputación </a></li>
<li class="toc-entry toc-h4"><a href="#2.2.3---Extensión-de-Imputación">2.2.3 - Extensión de Imputación </a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#2.3.--Variables-categóricas">2.3.- Variables categóricas </a>
<ul>
<li class="toc-entry toc-h4"><a href="#2.3.1--Eliminar-columna">2.3.1- Eliminar columna </a></li>
<li class="toc-entry toc-h4"><a href="#2.3.2--Codificación-ordinal">2.3.2- Codificación ordinal </a></li>
<li class="toc-entry toc-h4"><a href="#2.3.3--Codificación-One-Hot">2.3.3- Codificación One-Hot </a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#2.3--Codificaciones-de-caracteres">2.3- Codificaciones de caracteres </a></li>
<li class="toc-entry toc-h3"><a href="#2.4--Escalado-y-normalizado">2.4- Escalado y normalizado </a>
<ul>
<li class="toc-entry toc-h4"><a href="#Escalado">Escalado </a></li>
<li class="toc-entry toc-h4"><a href="#Normalizado">Normalizado </a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#2.5--Fechas">2.5- Fechas </a></li>
<li class="toc-entry toc-h3"><a href="#2.6--Entradas-de-datos-inconsistentes">2.6- Entradas de datos inconsistentes </a></li>
<li class="toc-entry toc-h3"><a href="#2.7--Ingeniería-de-datos">2.7- Ingeniería de datos </a>
<ul>
<li class="toc-entry toc-h4"><a href="#2.7.1--Información-mutua-(Mutual-Information,-MI)">2.7.1- Información mutua (Mutual Information, MI) </a></li>
<li class="toc-entry toc-h4"><a href="#2.7.2--Creando-nuevas-características">2.7.2- Creando nuevas características </a>
<ul>
<li class="toc-entry toc-h5"><a href="#2.7.2.1--Transformaciones-matemáticas">2.7.2.1- Transformaciones matemáticas </a></li>
<li class="toc-entry toc-h5"><a href="#2.7.2.2---Conteos">2.7.2.2-  Conteos </a></li>
<li class="toc-entry toc-h5"><a href="#2.7.2.3---Nuevas-variables-a-partir-de-unión-o-separación-de-otras">2.7.2.3-  Nuevas variables a partir de unión o separación de otras </a></li>
<li class="toc-entry toc-h5"><a href="#2.7.2.4---Transformaciones-de-grupos">2.7.2.4-  Transformaciones de grupos </a></li>
</ul>
</li>
<li class="toc-entry toc-h4"><a href="#2.7.3--Agrupación-con-K-medias">2.7.3- Agrupación con K-medias </a></li>
<li class="toc-entry toc-h4"><a href="#2.7.4--Analisis-de-componentes-principales-(PCA)">2.7.4- Analisis de componentes principales (PCA) </a></li>
<li class="toc-entry toc-h4"><a href="#2.7.5--Codificación-del-objetivo">2.7.5- Codificación del objetivo </a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#Separar-los-datos-para-entrenar-y-validar">Separar los datos para entrenar y validar </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#3--Seleccionar-el-modelo">3- Seleccionar el modelo </a></li>
<li class="toc-entry toc-h2"><a href="#4--Entrenar-el-modelo">4- Entrenar el modelo </a></li>
<li class="toc-entry toc-h2"><a href="#5--Evaluar-el-modelo">5- Evaluar el modelo </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Underfitting-and-Overfitting">Underfitting and Overfitting </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#6--Ajustar-los-parámetros">6- Ajustar los parámetros </a></li>
<li class="toc-entry toc-h2"><a href="#7--Generar-la-predicciones">7- Generar la predicciones </a></li>
<li class="toc-entry toc-h2"><a href="#Otros-puntos-a-tener-en-cuenta">Otros puntos a tener en cuenta </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Pipelines-(canalizaciones)">Pipelines (canalizaciones) </a>
<ul>
<li class="toc-entry toc-h4"><a href="#1--Definir-pasos-del-preprocesado">1- Definir pasos del preprocesado </a></li>
<li class="toc-entry toc-h4"><a href="#2--Definir-modelo">2- Definir modelo </a></li>
<li class="toc-entry toc-h4"><a href="#3--Crear-y-evaluar-el-preprocesado">3- Crear y evaluar el preprocesado </a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#Validación-cruzada-(Cross-Validation)">Validación cruzada (Cross-Validation) </a></li>
<li class="toc-entry toc-h3"><a href="#Método-XGBoost">Método XGBoost </a></li>
<li class="toc-entry toc-h3"><a href="#Data-leakage-(fuga-de-datos)">Data leakage (fuga de datos) </a></li>
</ul>
</li>
</ul>
</li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2021-08-16-Machine-Learning-con-Python.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p></p>
<div class="flash flash-success">
    <svg class="octicon octicon-checklist octicon octicon-checklist octicon octicon-checklist octicon octicon-checklist" viewbox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M2.5 1.75a.25.25 0 01.25-.25h8.5a.25.25 0 01.25.25v7.736a.75.75 0 101.5 0V1.75A1.75 1.75 0 0011.25 0h-8.5A1.75 1.75 0 001 1.75v11.5c0 .966.784 1.75 1.75 1.75h3.17a.75.75 0 000-1.5H2.75a.25.25 0 01-.25-.25V1.75zM4.75 4a.75.75 0 000 1.5h4.5a.75.75 0 000-1.5h-4.5zM4 7.75A.75.75 0 014.75 7h2a.75.75 0 010 1.5h-2A.75.75 0 014 7.75zm11.774 3.537a.75.75 0 00-1.048-1.074L10.7 14.145 9.281 12.72a.75.75 0 00-1.062 1.058l1.943 1.95a.75.75 0 001.055.008l4.557-4.45z"></path></svg>
    <strong>Tip: </strong>Puedes ver este post en GitHub o ejecutarlo en Binder o Google Colab, pulsa el icono.
</div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Fuentes:<br>
<a href="https://www.kaggle.com/learn">Cursos Machine Learning - Kaggle</a><br>
<a href="https://www.youtube.com/playlist?list=PL6kQim6ljTJsmPM_v_b2p8p-GPQhtoekI">MOOC - Aprendizaje automático - UPV</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Introducción">
<a class="anchor" href="#Introducci%C3%B3n" aria-hidden="true"><span class="octicon octicon-link"></span></a>Introducción<a class="anchor-link" href="#Introducci%C3%B3n"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Machine learning (aprendizaje automático)</strong> es una parte de la Inteligencia Artificial.<br>
Consiste en un nuevo paradigma de desarrollo de software. En lugar de decir al ordenador qué debe hacer con los datos, el desarrollador proporciona datos para que el ordenador <em>'aprenda'</em> a realizar una tarea específica.<br>
Es una herramienta muy útil para realizar tareas complejas en las que el ser humano prevalecía sobre las máquinas hasta hace poco tiempo, como el reconocimiento de imagenes. Además, se adapta muy bien a entornos cambiantes al contrario que el software convencional.<br>
El un software altamente dependiente de datos.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>En los últimos años, gracias a la recolección masiva de datos y al uso de GPUs (tarjetas gráficas) se ha avanzado mucho en el uso de <strong>redes neuronales</strong> artificiales, apareciendo una subcategoría llamada <strong>Deep Learning (aprendizaje profundo)</strong> que se basa en el uso de redes neuronales de múltiples capas.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Tareas</strong>: objetivos a resolver</p>
<ul>
<li>
<strong>Predictivas</strong> (aprendizaje supervisado): <ul>
<li>Clasificación: se obtiene un valor categórico</li>
<li>Regresión: se obtiene una valor numérico</li>
</ul>
</li>
<li>
<strong>Descriptivas</strong> (aprendizaje no supervisado):<ul>
<li>Clustering: encontrar grupos </li>
<li>Analisis exploratorio: <ul>
<li>Reglas de asociación,dependencias funcionales (var. categóricas)     </li>
<li>Análisis de correlación, dispersión, multivariable (var. numéricas)</li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Técnicas</strong>: algoritmos/procedimientos usados. Ejemplos según tarea a realizar:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<table>
<thead>
<tr>
<th>Técnica</th>
<th>Clasificación</th>
<th>Regresión</th>
<th>Clustering</th>
<th>Análisis exploratorio</th>
</tr>
</thead>
<tbody>
<tr>
<td>Redes neuronales</td>
<td>x</td>
<td>x</td>
<td>x</td>
<td>- </td>
</tr>
<tr>
<td>Árboles de decisión</td>
<td>x</td>
<td>x</td>
<td>x</td>
<td>- </td>
</tr>
<tr>
<td>Regresión lineal</td>
<td>-</td>
<td>x</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>Regresión logística</td>
<td>x</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>K-Means</td>
<td>x</td>
<td>-</td>
<td>x</td>
<td>-</td>
</tr>
<tr>
<td>A priori</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>x</td>
</tr>
<tr>
<td>Análisis factorial</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>x</td>
</tr>
<tr>
<td>Análisis multivariable</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>x</td>
</tr>
<tr>
<td>K-NN (vecinos cercanos)</td>
<td>x</td>
<td>-</td>
<td>x</td>
<td>-</td>
</tr>
<tr>
<td>Clasificadores bayesianos</td>
<td>x</td>
<td>x</td>
<td>-</td>
<td>-</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Herramientas</strong>: ayudan a utilizar las técnicas.</p>
<ul>
<li>
<strong>Lenguajes</strong> más usados: <ul>
<li>Python + librerias (scikit-learn, ...)</li>
<li>R  </li>
</ul>
</li>
<li>
<strong>Suites</strong>: software más visual y adaptado<ul>
<li>Open source: <ul>
<li>
<a href="http://old-www.cms.waikato.ac.nz/ml/weka/">Weka</a> </li>
<li><a href="https://rapidminer.com/get-started/">Rapid Miner</a></li>
</ul>
</li>
<li>Comerciales: <ul>
<li>
<a href="https://www.ibm.com/es-es/products/spss-modeler">IBM modeler</a> </li>
<li><a href="https://www.sas.com/es_ar/software/enterprise-miner.html">SAS Enterprise Miner</a></li>
<li><a href="https://docs.oracle.com/database/121/DMCON/GUID-0B1D8B18-218B-46C6-92A1-2A499F961D49.htm#DMCON001">Oracle BI Data Miner</a></li>
</ul>
</li>
</ul>
</li>
<li>
<strong>Nube</strong>: <ul>
<li><a href="https://azure.microsoft.com/es-es/">AzureML Microsoft</a></li>
<li><a href="https://cloud.google.com/products/ai">Google Cloud</a></li>
<li><a href="https://aws.amazon.com/es/">Amazon AWS</a></li>
<li><a href="https://bigml.com/">BigML</a></li>
<li>...</li>
</ul>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Los-pasos-a-seguir-para-obtener-un-software-de-aprendizaje-automático-son:">
<a class="anchor" href="#Los-pasos-a-seguir-para-obtener-un-software-de-aprendizaje-autom%C3%A1tico-son:" aria-hidden="true"><span class="octicon octicon-link"></span></a>Los pasos a seguir para obtener un software de aprendizaje automático son:<a class="anchor-link" href="#Los-pasos-a-seguir-para-obtener-un-software-de-aprendizaje-autom%C3%A1tico-son:"> </a>
</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="1---Recoger-los-datos">
<a class="anchor" href="#1---Recoger-los-datos" aria-hidden="true"><span class="octicon octicon-link"></span></a>1 - Recoger los datos<a class="anchor-link" href="#1---Recoger-los-datos"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="2---Preparar-los-datos">
<a class="anchor" href="#2---Preparar-los-datos" aria-hidden="true"><span class="octicon octicon-link"></span></a>2 - Preparar los datos<a class="anchor-link" href="#2---Preparar-los-datos"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="2.1---Exploración-de-los-datos">
<a class="anchor" href="#2.1---Exploraci%C3%B3n-de-los-datos" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.1 - Exploración de los datos<a class="anchor-link" href="#2.1---Exploraci%C3%B3n-de-los-datos"> </a>
</h3>
<p>Importante leer la documentación de los datos y estudiarlos bien.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">datos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ruta_archivo</span><span class="p">)</span> <span class="c1"># cargar datos desde tabla en archivo csv</span>
<span class="n">datos</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>                  <span class="c1"># imprime resumen de los datos</span>
<span class="n">datos</span><span class="o">.</span><span class="n">columns</span>                     <span class="c1"># imprime lista de las columnas</span>
<span class="n">datos</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>                      <span class="c1"># imprime lista de las 5 primeras muestras de la tabla</span>
<span class="n">datos</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>                      <span class="c1"># imprime lista de las 5 últimas muestras de la tabla</span>

<span class="n">datos_filtrados</span> <span class="o">=</span> <span class="n">datos</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># elimina datos na (no available - no disponibles)</span>
</pre></div>

    </div>
</div>
</div>
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Output" data-close="Show Output"></summary>
        <p>
</p>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipykernel_4097/2228622085.py</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-green-fg">import</span> pandas <span class="ansi-green-fg">as</span> pd
<span class="ansi-green-intense-fg ansi-bold">      2</span> 
<span class="ansi-green-fg">----&gt; 3</span><span class="ansi-red-fg"> </span>datos <span class="ansi-blue-fg">=</span> pd<span class="ansi-blue-fg">.</span>read_csv<span class="ansi-blue-fg">(</span>ruta_archivo<span class="ansi-blue-fg">)</span> <span class="ansi-red-fg"># cargar datos desde tabla en archivo csv</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span> datos<span class="ansi-blue-fg">.</span>describe<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>                  <span class="ansi-red-fg"># imprime resumen de los datos</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span> datos<span class="ansi-blue-fg">.</span>columns                     <span class="ansi-red-fg"># imprime lista de las columnas</span>

<span class="ansi-red-fg">NameError</span>: name 'ruta_archivo' is not defined</pre>
</div>
</div>

</div>
</div>

    </details>
</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X_full</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">'SalePrice'</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># Eliminar filas sin datos destino, </span>

<span class="c1"># elegir la columna que deseamos estimar en nuestro modelo</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">X_full</span><span class="o">.</span><span class="n">SalePrice</span>

<span class="c1"># elegir las columnas que se pasarán al modelo</span>
<span class="c1"># opción 1: quitar la columna destino</span>
<span class="n">X_full</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">'SalePrice'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># opción 2: elegir sólo algunas columnas</span>
<span class="n">datos_features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Rooms'</span><span class="p">,</span> <span class="s1">'Bathroom'</span><span class="p">,</span><span class="s1">'Lattitude'</span><span class="p">,</span> <span class="s1">'Longtitude'</span><span class="p">]</span> 
<span class="n">X</span> <span class="o">=</span> <span class="n">datos</span><span class="p">[</span><span class="n">datos_features</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="2.2--Tratamiento-de-valores-que-faltan">
<a class="anchor" href="#2.2--Tratamiento-de-valores-que-faltan" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.2- Tratamiento de valores que faltan<a class="anchor-link" href="#2.2--Tratamiento-de-valores-que-faltan"> </a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>¿Por qué faltan los valores?</p>
<ul>
<li>No existen -&gt; no hacer nada, no tiene sentido intentar estimarlos</li>
<li>No han sido grabados -&gt; se puede intentar estimarlos, basándonos en otros valores de la tabla</li>
</ul>
<p>Revisar cada columna para averiguar cual es la mejor aproximación.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">missing_val_count_by_column</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="c1"># Número de valores faltantes en cada columna de datos de entrenamiento </span>

<span class="nb">print</span><span class="p">(</span><span class="n">missing_val_count_by_column</span><span class="p">[</span><span class="n">missing_val_count_by_column</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span>

<span class="c1"># how many total missing values do we have?</span>
<span class="n">total_cells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">total_missing</span> <span class="o">=</span> <span class="n">missing_val_count_by_column</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># percent of data that is missing</span>
<span class="n">percent_missing</span> <span class="o">=</span> <span class="p">(</span><span class="n">total_missing</span><span class="o">/</span><span class="n">total_cells</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="2.2.1---Eliminar-columna">
<a class="anchor" href="#2.2.1---Eliminar-columna" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.2.1 - Eliminar columna<a class="anchor-link" href="#2.2.1---Eliminar-columna"> </a>
</h4>
<p>Para el caso en falten la mayoría de datos de una variable. Sino se puede perder información importante.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cols_with_missing</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">X_train</span><span class="o">.</span><span class="n">columns</span>
                     <span class="k">if</span> <span class="n">X_train</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">()]</span>       <span class="c1"># recopilar columnas con valores que faltan</span>

<span class="c1"># eliminar columnas con valores que faltan</span>
<span class="n">reduced_X_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">cols_with_missing</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  
<span class="n">reduced_X_valid</span> <span class="o">=</span> <span class="n">X_valid</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">cols_with_missing</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">reduced_X_train</span><span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>  <span class="c1"># Otra opción: elimina todas las columnas con datos no disponibles</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="2.2.2---Imputación">
<a class="anchor" href="#2.2.2---Imputaci%C3%B3n" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.2.2 - Imputación<a class="anchor-link" href="#2.2.2---Imputaci%C3%B3n"> </a>
</h4>
<p>Rellenar los valores faltantes con otro valor, por ejemplo: la media.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>

<span class="c1"># Imputación</span>
<span class="n">my_imputer</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">'median'</span><span class="p">)</span>  <span class="c1"># mean, median, most_frequent, constant</span>

<span class="n">imputed_X_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">my_imputer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                          <span class="n">columns</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>  
<span class="n">imputed_X_valid</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">my_imputer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_valid</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">X_valid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                          <span class="n">columns</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">X_valid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>  

<span class="c1"># Imputación quitó los nombres de columnas, volver a ponerlos </span>
<span class="n">imputed_X_train</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">columns</span>
<span class="n">imputed_X_valid</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">X_valid</span><span class="o">.</span><span class="n">columns</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X_train</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># reemplazar con 0 los NA</span>
<span class="n">X_train</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">'bfill'</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># reemplaza también los valores que vienen después en la misma columna</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="2.2.3---Extensión-de-Imputación">
<a class="anchor" href="#2.2.3---Extensi%C3%B3n-de-Imputaci%C3%B3n" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.2.3 - Extensión de Imputación<a class="anchor-link" href="#2.2.3---Extensi%C3%B3n-de-Imputaci%C3%B3n"> </a>
</h4>
<p>Añadiendo otra columna que informe si faltaba o no el valor.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X_train_plus</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1"># Hacer una copia para evitar cambiar los datos originales (al imputar) </span>
<span class="n">X_valid_plus</span> <span class="o">=</span> <span class="n">X_valid</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Hacer nuevas columnas que indiquen lo que se imputará. </span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols_with_missing</span><span class="p">:</span>
    <span class="n">X_train_plus</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="s1">'_was_missing'</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_train_plus</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
    <span class="n">X_valid_plus</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="s1">'_was_missing'</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_valid_plus</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>

<span class="c1"># Imputación</span>
<span class="n">my_imputer</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">()</span>
<span class="n">imputed_X_train_plus</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">my_imputer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train_plus</span><span class="p">))</span>
<span class="n">imputed_X_valid_plus</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">my_imputer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_valid_plus</span><span class="p">))</span>

<span class="c1"># Imputación quitó los nombres de columnas, volver a ponerlos </span>
<span class="n">imputed_X_train_plus</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">X_train_plus</span><span class="o">.</span><span class="n">columns</span>
<span class="n">imputed_X_valid_plus</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">X_valid_plus</span><span class="o">.</span><span class="n">columns</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="2.3.--Variables-categóricas">
<a class="anchor" href="#2.3.--Variables-categ%C3%B3ricas" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.3.- Variables categóricas<a class="anchor-link" href="#2.3.--Variables-categ%C3%B3ricas"> </a>
</h3>
<p>Toman un número limitado de valores. Necesitan ser preprocesados antes de usarlos en los modelos.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">object_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">X_train</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">X_train</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s2">"object"</span><span class="p">]</span>
<span class="c1"># para obtener lista de variables categóricas </span>

<span class="nb">print</span><span class="p">(</span><span class="n">object_cols</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">good_label_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">object_cols</span> <span class="k">if</span>   <span class="c1"># Columnas que se pueden codificar con etiquetas de forma segura </span>
                   <span class="nb">set</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="n">col</span><span class="p">])</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">X_valid</span><span class="p">[</span><span class="n">col</span><span class="p">])]</span>
        
<span class="c1"># Columnas problemáticas que se eliminarán del conjunto de datos</span>
<span class="n">bad_label_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">object_cols</span><span class="p">)</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="n">good_label_cols</span><span class="p">))</span>

<span class="c1"># Aplicar codificador de etiquetas </span>
<span class="n">label_encoder</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">()</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">good_label_cols</span><span class="p">:</span>
    <span class="n">label_X_train</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">label_encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
    <span class="n">label_X_valid</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">label_encoder</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_valid</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">object_nunique</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">col</span><span class="p">:</span> <span class="n">X_train</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">(),</span> <span class="n">object_cols</span><span class="p">))</span> 
<span class="c1"># Obtener el número de entradas únicas en cada columna con datos categóricos </span>
<span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">object_cols</span><span class="p">,</span> <span class="n">object_nunique</span><span class="p">))</span>

<span class="c1"># Imprimirc el número de entradas únicas por columna, en orden ascendente </span>
<span class="nb">sorted</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="2.3.1--Eliminar-columna">
<a class="anchor" href="#2.3.1--Eliminar-columna" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.3.1- Eliminar columna<a class="anchor-link" href="#2.3.1--Eliminar-columna"> </a>
</h4>
<p>Sólo es buena opción si la columna no tiene información útil.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">drop_X_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s1">'object'</span><span class="p">])</span>
<span class="n">drop_X_valid</span> <span class="o">=</span> <span class="n">X_valid</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s1">'object'</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="2.3.2--Codificación-ordinal">
<a class="anchor" href="#2.3.2--Codificaci%C3%B3n-ordinal" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.3.2- Codificación ordinal<a class="anchor-link" href="#2.3.2--Codificaci%C3%B3n-ordinal"> </a>
</h4>
<p>Asigna un entero a cada valor único. Asume un orden en las categorías. Variables ordinales.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OrdinalEncoder</span>

<span class="c1"># Hacer una copia para evitar cambiar los datos originales </span>
<span class="n">label_X_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">label_X_valid</span> <span class="o">=</span> <span class="n">X_valid</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Aplicar codificador ordinal a cada columna con datos categóricos </span>
<span class="n">ordinal_encoder</span> <span class="o">=</span> <span class="n">OrdinalEncoder</span><span class="p">()</span>
<span class="n">label_X_train</span><span class="p">[</span><span class="n">object_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">ordinal_encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="n">object_cols</span><span class="p">])</span>
<span class="n">label_X_valid</span><span class="p">[</span><span class="n">object_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">ordinal_encoder</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_valid</span><span class="p">[</span><span class="n">object_cols</span><span class="p">])</span>

<span class="c1"># De esta forma ha asigando valores aleatorios a las categorías. Asignar un orden puede mejorar el modelo.</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="2.3.3--Codificación-One-Hot">
<a class="anchor" href="#2.3.3--Codificaci%C3%B3n-One-Hot" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.3.3- Codificación <em>One-Hot</em><a class="anchor-link" href="#2.3.3--Codificaci%C3%B3n-One-Hot"> </a>
</h4>
<p>Crea una columna por cada valor único e indica la presencia o no de ese valor. No asume un orden en las categorías. Variables nominales. No funciona bien si hay muchas categorias. Usar si hay 15 como máximo.</p>
<ul>
<li>handle_unknown='ignore': para evitar errores cuando los datos de validación contienen clases que no están representadas en los datos de entrenamiento </li>
<li>sparse=False: asegura que las columnas codificadas se devuelvan como una matriz densa (en lugar de una matriz dispersa)</li>
</ul>
<p>Suele ser la mejor aproximación.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span>

<span class="c1"># Columnas que se codificarán one-hot (como máximo 10 categorias)</span>
<span class="n">low_cardinality_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">object_cols</span> <span class="k">if</span> <span class="n">X_train</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">]</span>

<span class="c1"># Columnas que se eliminarán</span>
<span class="n">high_cardinality_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">object_cols</span><span class="p">)</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="n">low_cardinality_cols</span><span class="p">))</span>


<span class="c1"># Aplicar codificador one-hot a cada columna con datos categóricos</span>
<span class="n">OH_encoder</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s1">'ignore'</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">OH_cols_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">OH_encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="n">low_cardinality_cols</span><span class="p">]))</span>
<span class="n">OH_cols_valid</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">OH_encoder</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_valid</span><span class="p">[</span><span class="n">low_cardinality_cols</span><span class="p">]))</span>

<span class="c1"># codificador one-hot elimina; ponerlo de nuevo </span>
<span class="n">OH_cols_train</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">index</span>
<span class="n">OH_cols_valid</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">X_valid</span><span class="o">.</span><span class="n">index</span>

<span class="c1"># Eliminar columnas categóricas (se reemplazarán con codificación one-hot) </span>
<span class="n">num_X_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">object_cols</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">num_X_valid</span> <span class="o">=</span> <span class="n">X_valid</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">object_cols</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1">#  añadir columnas codificadas one-hot a variables numéricas </span>
<span class="n">OH_X_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">num_X_train</span><span class="p">,</span> <span class="n">OH_cols_train</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">OH_X_valid</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">num_X_valid</span><span class="p">,</span> <span class="n">OH_cols_valid</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="2.3--Codificaciones-de-caracteres">
<a class="anchor" href="#2.3--Codificaciones-de-caracteres" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.3- Codificaciones de caracteres<a class="anchor-link" href="#2.3--Codificaciones-de-caracteres"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">chardet</span>
<span class="n">after</span> <span class="o">=</span> <span class="n">before</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">"utf-8"</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">"replace"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Detectar codificación automáticamente</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"../data.csv"</span><span class="p">,</span> <span class="s1">'rb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">rawdata</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">chardet</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">rawdata</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">10000</span><span class="p">))</span>  <span class="c1"># en este caso lee 10.000 caracteres</span>
    
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">'encoding'</span><span class="p">])</span>
<span class="n">datos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"./data.csv"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s1">'encoding'</span><span class="p">])</span> <span class="c1"># guardar en archivo</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="2.4--Escalado-y-normalizado">
<a class="anchor" href="#2.4--Escalado-y-normalizado" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.4- Escalado y normalizado<a class="anchor-link" href="#2.4--Escalado-y-normalizado"> </a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Escalado">
<a class="anchor" href="#Escalado" aria-hidden="true"><span class="octicon octicon-link"></span></a>Escalado<a class="anchor-link" href="#Escalado"> </a>
</h4>
<p>Cambia el rango de los datos. Por ejemplo, pasar datos a un rango 0-1 o 0-100.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">mlxtend.preprocessing</span> <span class="kn">import</span> <span class="n">minmax_scaling</span>

<span class="n">scaled_data</span> <span class="o">=</span> <span class="n">minmax_scaling</span><span class="p">(</span><span class="n">original_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1">#  escalado entre 0 y 1</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Normalizado">
<a class="anchor" href="#Normalizado" aria-hidden="true"><span class="octicon octicon-link"></span></a>Normalizado<a class="anchor-link" href="#Normalizado"> </a>
</h4>
<p>Cambia la forma del histograma para que sea una distribución normal (Gaussiana):</p>
<ul>
<li>Media = mediana = moda</li>
<li>Forma de campana</li>
</ul>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>

<span class="c1"># obtener el índice de todos los valores positivos (Box-Cox solo acepta valores positivos) </span>
<span class="n">index_of_positives</span> <span class="o">=</span> <span class="n">datos</span><span class="o">.</span><span class="n">pledged</span> <span class="o">&gt;</span> <span class="mi">0</span>

<span class="c1"># get only positive pledges (using their indexes)</span>
<span class="n">valores_positivos</span> <span class="o">=</span> <span class="n">datos</span><span class="o">.</span><span class="n">columnaA</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index_of_positives</span><span class="p">]</span>

<span class="c1"># normalizar con Box-Cox</span>
<span class="n">norm_valores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">boxcox</span><span class="p">(</span><span class="n">valores_positivos</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> 
                               <span class="n">name</span><span class="o">=</span><span class="s1">'columnaA'</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">valores_positivos</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="2.5--Fechas">
<a class="anchor" href="#2.5--Fechas" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.5- Fechas<a class="anchor-link" href="#2.5--Fechas"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="n">datos</span><span class="p">[</span><span class="s1">'nueva_columna'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">datos</span><span class="p">[</span><span class="s1">'fecha'</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s2">"</span><span class="si">%d</span><span class="s2">/%m/%y"</span><span class="p">,</span><span class="n">infer_datetime_format</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># infer_datetime_format=True : usar sólo cuando sea extrictamente necesario</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dia_mes</span> <span class="o">=</span> <span class="n">datos</span><span class="p">[</span><span class="s1">'nueva_columna'</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span>  <span class="c1"># día del mes</span>

<span class="c1"># quitar los datos no disponibles  </span>
<span class="n">dia_mes</span>  <span class="o">=</span> <span class="n">dia_mes</span> <span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># plot the day of the month</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">dia_mes</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">31</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">date_lengths</span> <span class="o">=</span> <span class="n">datos</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len</span><span class="p">()</span>  <span class="c1"># comprobar la longitud de los valores</span>
<span class="n">date_lengths</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>

<span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">([</span><span class="n">date_lengths</span> <span class="o">==</span> <span class="mi">24</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Indices con datos corruptos:'</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>
<span class="n">datos</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="2.6--Entradas-de-datos-inconsistentes">
<a class="anchor" href="#2.6--Entradas-de-datos-inconsistentes" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.6- Entradas de datos inconsistentes<a class="anchor-link" href="#2.6--Entradas-de-datos-inconsistentes"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">professors</span><span class="p">[</span><span class="s1">'Country'</span><span class="p">]</span> <span class="o">=</span> <span class="n">professors</span><span class="p">[</span><span class="s1">'Country'</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="c1"># convertir a minúsculas</span>
<span class="n">professors</span><span class="p">[</span><span class="s1">'Country'</span><span class="p">]</span> <span class="o">=</span> <span class="n">professors</span><span class="p">[</span><span class="s1">'Country'</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="c1"># quitar espacios en blanco, al principio y fin</span>

<span class="c1"># coger los 10 más cercanos a south korea</span>
<span class="n">countries</span> <span class="o">=</span> <span class="n">professors</span><span class="p">[</span><span class="s1">'Country'</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">matches</span> <span class="o">=</span> <span class="n">fuzzywuzzy</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s2">"south korea"</span><span class="p">,</span> <span class="n">countries</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scorer</span><span class="o">=</span><span class="n">fuzzywuzzy</span><span class="o">.</span><span class="n">fuzz</span><span class="o">.</span><span class="n">token_sort_ratio</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">replace_matches_in_column</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">string_to_match</span><span class="p">,</span> <span class="n">min_ratio</span> <span class="o">=</span> <span class="mi">47</span><span class="p">):</span>
    <span class="c1"># lista de valores únicos</span>
    <span class="n">strings</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    
    <span class="c1"># coger los 10 más cercanos a la cadena de entrada</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="n">fuzzywuzzy</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">string_to_match</span><span class="p">,</span> <span class="n">strings</span><span class="p">,</span> 
                                         <span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scorer</span><span class="o">=</span><span class="n">fuzzywuzzy</span><span class="o">.</span><span class="n">fuzz</span><span class="o">.</span><span class="n">token_sort_ratio</span><span class="p">)</span>

    <span class="c1"># coger solo los que superan el límite</span>
    <span class="n">close_matches</span> <span class="o">=</span> <span class="p">[</span><span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">matches</span> <span class="ow">in</span> <span class="n">matches</span> <span class="k">if</span> <span class="n">matches</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">min_ratio</span><span class="p">]</span>

    <span class="c1"># coger las filas que encajan en nuestra tabla</span>
    <span class="n">rows_with_matches</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">close_matches</span><span class="p">)</span>

    <span class="c1"># reemplace todas las filas con coincidencias cercanas con las coincidencias de entrada </span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rows_with_matches</span><span class="p">,</span> <span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">string_to_match</span>
    
    <span class="c1"># avisar cuando acaba la función</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"All done!"</span><span class="p">)</span>
    
<span class="n">replace_matches_in_column</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">professors</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s1">'Country'</span><span class="p">,</span> <span class="n">string_to_match</span><span class="o">=</span><span class="s2">"south korea"</span><span class="p">)</span>
<span class="n">countries</span> <span class="o">=</span> <span class="n">professors</span><span class="p">[</span><span class="s1">'Country'</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="2.7--Ingeniería-de-datos">
<a class="anchor" href="#2.7--Ingenier%C3%ADa-de-datos" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.7- Ingeniería de datos<a class="anchor-link" href="#2.7--Ingenier%C3%ADa-de-datos"> </a>
</h3>
<p>Modificar los datos para mejorar la resolución del problema.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Ventajas:</p>
<ul>
<li>Mejora del rendimiento en las predicciones</li>
<li>Disminuye necesidad computacional y de datos</li>
<li>Mejora la interpretabilidad de los resultados</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="2.7.1--Información-mutua-(Mutual-Information,-MI)">
<a class="anchor" href="#2.7.1--Informaci%C3%B3n-mutua-(Mutual-Information,-MI)" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.7.1- Información mutua (Mutual Information, MI)<a class="anchor-link" href="#2.7.1--Informaci%C3%B3n-mutua-(Mutual-Information,-MI)"> </a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Primero crear una métrica que mida la utilidad de cada característica con el objetivo, para luego escoger un conjunto menor con las características mas útiles.
Para ello podemos usar la métrica <strong>Información mutua</strong> que encuentra relaciones de cualquier tipo entre variables, no sólo lineales como el coeficiente de correlación. 
Mide el grado que una variable reduce la incertidumbre sobre el objetivo.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">mutual_info_regression</span>

<span class="k">def</span> <span class="nf">make_mi_scores</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">discrete_features</span><span class="p">):</span>
    <span class="n">mi_scores</span> <span class="o">=</span> <span class="n">mutual_info_regression</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">discrete_features</span><span class="o">=</span><span class="n">discrete_features</span><span class="p">)</span>
    <span class="n">mi_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">mi_scores</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"MI Scores"</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">mi_scores</span> <span class="o">=</span> <span class="n">mi_scores</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mi_scores</span>

<span class="n">mi_scores</span> <span class="o">=</span> <span class="n">make_mi_scores</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">discrete_features</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">plot_mi_scores</span><span class="p">(</span><span class="n">scores</span><span class="p">):</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="n">scores</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">width</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scores</span><span class="p">))</span>
    <span class="n">ticks</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">ticks</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Mutual Information Scores"</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plot_mi_scores</span><span class="p">(</span><span class="n">mi_scores</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="2.7.2--Creando-nuevas-características">
<a class="anchor" href="#2.7.2--Creando-nuevas-caracter%C3%ADsticas" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.7.2- Creando nuevas características<a class="anchor-link" href="#2.7.2--Creando-nuevas-caracter%C3%ADsticas"> </a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Es importante:</p>
<ul>
<li>estudiar bien:<ul>
<li>las características que tenemos</li>
<li>el dominio de conocimiento del problema</li>
<li>trabajos previos</li>
</ul>
</li>
<li>visualizar los datos</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Observaciones:</p>
<ul>
<li>Los modelos lineales sólo aprenden sumas y diferencias de forma natural, pero no pueden aprender nada más complejo.</li>
<li>Los modelos no suelen aprender ratios. Si se usan mejora el rendimiento.</li>
<li>Modelos lineales y redes neuronales -&gt; normalizar primero</li>
<li>Los conteos son especialmente útiles en los árboles de decisión</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="2.7.2.1--Transformaciones-matemáticas">
<a class="anchor" href="#2.7.2.1--Transformaciones-matem%C3%A1ticas" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.7.2.1- Transformaciones matemáticas<a class="anchor-link" href="#2.7.2.1--Transformaciones-matem%C3%A1ticas"> </a>
</h5>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Ratios entre variables y totales
Cambio de rango y de forma: normalización</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="2.7.2.2---Conteos">
<a class="anchor" href="#2.7.2.2---Conteos" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.7.2.2-  Conteos<a class="anchor-link" href="#2.7.2.2---Conteos"> </a>
</h5>
<p>Pasando a binario las variables (0 - ausencia, 1- presencia)</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">roadway_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"Amenity"</span><span class="p">,</span> <span class="s2">"Bump"</span><span class="p">,</span> <span class="s2">"Crossing"</span><span class="p">,</span> <span class="s2">"GiveWay"</span><span class="p">,</span>
    <span class="s2">"Junction"</span><span class="p">,</span> <span class="s2">"NoExit"</span><span class="p">,</span> <span class="s2">"Railway"</span><span class="p">,</span> <span class="s2">"Roundabout"</span><span class="p">,</span> <span class="s2">"Station"</span><span class="p">,</span> <span class="s2">"Stop"</span><span class="p">,</span>
    <span class="s2">"TrafficCalming"</span><span class="p">,</span> <span class="s2">"TrafficSignal"</span><span class="p">]</span>

<span class="c1"># se crea una nueva variable con el conteo</span>
<span class="n">accidents</span><span class="p">[</span><span class="s2">"RoadwayFeatures"</span><span class="p">]</span> <span class="o">=</span> <span class="n">accidents</span><span class="p">[</span><span class="n">roadway_features</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># se muestran los 10 primeros casos</span>
<span class="n">accidents</span><span class="p">[</span><span class="n">roadway_features</span> <span class="o">+</span> <span class="p">[</span><span class="s2">"RoadwayFeatures"</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">components</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">"Cement"</span><span class="p">,</span> <span class="s2">"BlastFurnaceSlag"</span><span class="p">,</span> <span class="s2">"FlyAsh"</span><span class="p">,</span> <span class="s2">"Water"</span><span class="p">,</span>
               <span class="s2">"Superplasticizer"</span><span class="p">,</span> <span class="s2">"CoarseAggregate"</span><span class="p">,</span> <span class="s2">"FineAggregate"</span><span class="p">]</span>
<span class="c1"># se crea una nueva variable con el conteo cuando es mayor que 0 (gt(0))</span>
<span class="n">concrete</span><span class="p">[</span><span class="s2">"Components"</span><span class="p">]</span> <span class="o">=</span> <span class="n">concrete</span><span class="p">[</span><span class="n">components</span><span class="p">]</span><span class="o">.</span><span class="n">gt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  
<span class="c1"># se muestran los 10 primeros casos</span>
<span class="n">concrete</span><span class="p">[</span><span class="n">components</span> <span class="o">+</span> <span class="p">[</span><span class="s2">"Components"</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="2.7.2.3---Nuevas-variables-a-partir-de-unión-o-separación-de-otras">
<a class="anchor" href="#2.7.2.3---Nuevas-variables-a-partir-de-uni%C3%B3n-o-separaci%C3%B3n-de-otras" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.7.2.3-  Nuevas variables a partir de unión o separación de otras<a class="anchor-link" href="#2.7.2.3---Nuevas-variables-a-partir-de-uni%C3%B3n-o-separaci%C3%B3n-de-otras"> </a>
</h5>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">customer</span><span class="p">[[</span><span class="s2">"Type"</span><span class="p">,</span> <span class="s2">"Level"</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span>  <span class="c1"># Crear dos nueva variables</span>
    <span class="n">customer</span><span class="p">[</span><span class="s2">"ColumnaA"</span><span class="p">]</span>         <span class="c1"># de la variable ColumnaA</span>
    <span class="o">.</span><span class="n">str</span>                         <span class="c1"># </span>
    <span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">" "</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>     <span class="c1"># separando por " "</span>
                                 <span class="c1"># y expandiendo en columna separadas</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">datos</span><span class="p">[</span><span class="s2">"variable A+B"</span><span class="p">]</span> <span class="o">=</span> <span class="n">datos</span><span class="p">[</span><span class="s2">"variable A"</span><span class="p">]</span> <span class="o">+</span> <span class="s2">"_"</span> <span class="o">+</span> <span class="n">datos</span><span class="p">[</span><span class="s2">"variable B"</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="2.7.2.4---Transformaciones-de-grupos">
<a class="anchor" href="#2.7.2.4---Transformaciones-de-grupos" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.7.2.4-  Transformaciones de grupos<a class="anchor-link" href="#2.7.2.4---Transformaciones-de-grupos"> </a>
</h5>
<p>Agregando información entre diferentes filas</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">customer</span><span class="p">[</span><span class="s2">"AverageIncome"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">customer</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">"State"</span><span class="p">)</span>  <span class="c1"># por cada 'State'</span>
    <span class="p">[</span><span class="s2">"Income"</span><span class="p">]</span>                 <span class="c1"># seleccionar 'Income'</span>
    <span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s2">"mean"</span><span class="p">)</span>         <span class="c1"># y calcula la media (max, min, median, var, std, and count)</span>
<span class="p">)</span>

<span class="n">customer</span><span class="p">[[</span><span class="s2">"State"</span><span class="p">,</span> <span class="s2">"Income"</span><span class="p">,</span> <span class="s2">"AverageIncome"</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">customer</span><span class="p">[</span><span class="s2">"StateFreq"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>      <span class="c1"># para calcular la frecuencia</span>
    <span class="n">customer</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">"State"</span><span class="p">)</span>
    <span class="p">[</span><span class="s2">"State"</span><span class="p">]</span>
    <span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s2">"count"</span><span class="p">)</span>
    <span class="o">/</span> <span class="n">customer</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">customer</span><span class="p">[[</span><span class="s2">"State"</span><span class="p">,</span> <span class="s2">"StateFreq"</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="2.7.3--Agrupación-con-K-medias">
<a class="anchor" href="#2.7.3--Agrupaci%C3%B3n-con-K-medias" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.7.3- Agrupación con K-medias<a class="anchor-link" href="#2.7.3--Agrupaci%C3%B3n-con-K-medias"> </a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Es un algoritmo de aprendizaje no supervisado (datos no etiquetados).<br>
Herramienta para encontrar características en los datos.</p>
<p>Apicado a:</p>
<ul>
<li>una característica de valores reales -&gt; discretización</li>
<li>varias características de valores reales -&gt; cuantización vectorial</li>
</ul>
<p>El resultado es una variable categórica.
Mide la similitud en base a la distancia euclídea. Se colocan k centroides creando agrupaciones en cada uno.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/blog/images/copied_from_nb/images/kmeans.gif" alt=""></p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"SalePrice"</span><span class="p">)</span>

<span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'LotArea'</span><span class="p">,</span> <span class="s1">'TotalBsmtSF'</span><span class="p">,</span> <span class="s1">'FirstFlrSF'</span><span class="p">,</span> <span class="s1">'SecondFlrSF'</span><span class="p">,</span><span class="s1">'GrLivArea'</span><span class="p">]</span>

<span class="c1"># Standardize</span>
<span class="n">X_scaled</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">features</span><span class="p">]</span>
<span class="n">X_scaled</span> <span class="o">=</span> <span class="p">(</span><span class="n">X_scaled</span> <span class="o">-</span> <span class="n">X_scaled</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span> <span class="o">/</span> <span class="n">X_scaled</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Fit the KMeans model to X_scaled and create the cluster labels</span>
<span class="n">kmeans</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">n_init</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">X</span><span class="p">[</span><span class="s2">"Cluster"</span><span class="p">]</span> <span class="o">=</span>  <span class="n">kmeans</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">relplot</span><span class="p">(</span>           
    <span class="n">x</span><span class="o">=</span><span class="s2">"Longitude"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Latitude"</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">"Cluster"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
<span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X</span><span class="p">[</span><span class="s2">"MedHouseVal"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">"MedHouseVal"</span><span class="p">]</span>
<span class="n">sns</span><span class="o">.</span><span class="n">catplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"MedHouseVal"</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"Cluster"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">"boxen"</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">6</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="2.7.4--Analisis-de-componentes-principales-(PCA)">
<a class="anchor" href="#2.7.4--Analisis-de-componentes-principales-(PCA)" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.7.4- Analisis de componentes principales (PCA)<a class="anchor-link" href="#2.7.4--Analisis-de-componentes-principales-(PCA)"> </a>
</h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Herramienta para encontrar relacciones en los datos y características más útiles.<br>
Normalizar los datos antes de usar PCA.
PCA nos dice la cantidad de variación de cada componente.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Modos de usarlo:</p>
<ul>
<li>como técnica descriptiva</li>
<li>usando los componentes como características del modelo.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Cuando usarlo:</p>
<ul>
<li>reducción de dimensionalidad</li>
<li>detección de anomalias</li>
<li>reducción de ruido</li>
<li>reduccir correlación</li>
</ul>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>

<span class="c1"># Estandarizar</span>
<span class="n">X_scaled</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span> <span class="o">-</span> <span class="n">X</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span> <span class="o">/</span> <span class="n">X</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">()</span>
<span class="n">X_pca</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">)</span>

<span class="c1"># Convertir a tabla</span>
<span class="n">component_names</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">"PC</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">"</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X_pca</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
<span class="n">X_pca</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_pca</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">component_names</span><span class="p">)</span>

<span class="n">X_pca</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">loadings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">pca</span><span class="o">.</span><span class="n">components_</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>  <span class="c1"># transpose the matrix of loadings</span>
    <span class="n">columns</span><span class="o">=</span><span class="n">component_names</span><span class="p">,</span>  <span class="c1"># so the columns are the principal components</span>
    <span class="n">index</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>  <span class="c1"># and the rows are the original features</span>
<span class="p">)</span>
<span class="n">loadings</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plot_variance</span><span class="p">(</span><span class="n">pca</span><span class="p">);</span><span class="c1"># Look at explained variance</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="2.7.5--Codificación-del-objetivo">
<a class="anchor" href="#2.7.5--Codificaci%C3%B3n-del-objetivo" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.7.5- Codificación del objetivo<a class="anchor-link" href="#2.7.5--Codificaci%C3%B3n-del-objetivo"> </a>
</h4>
<p>Método para codificar categorías como números.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Codificación por media</strong> (puede ser codificación por probabidad,impacto...)</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">autos</span><span class="p">[</span><span class="s2">"make_encoded"</span><span class="p">]</span> <span class="o">=</span> <span class="n">autos</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">"make"</span><span class="p">)[</span><span class="s2">"price"</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s2">"mean"</span><span class="p">)</span>

<span class="n">autos</span><span class="p">[[</span><span class="s2">"make"</span><span class="p">,</span> <span class="s2">"price"</span><span class="p">,</span> <span class="s2">"make_encoded"</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Suavizado</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Cuando usarlo:</p>
<ul>
<li>Caracterítica con muchas categorias</li>
<li>Caracterítica motivada por el dominio:cuando se sospecha la importancia a pesar de tener una métrica pobre</li>
</ul>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">category_encoders</span> <span class="kn">import</span> <span class="n">MEstimateEncoder</span>

<span class="c1"># Create the encoder instance. Choose m to control noise.</span>
<span class="n">encoder</span> <span class="o">=</span> <span class="n">MEstimateEncoder</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="s2">"Zipcode"</span><span class="p">],</span> <span class="n">m</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>

<span class="c1"># Fit the encoder on the encoding split.</span>
<span class="n">encoder</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_encode</span><span class="p">,</span> <span class="n">y_encode</span><span class="p">)</span>

<span class="c1"># Encode the Zipcode column to create the final training data</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_pretrain</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Separar-los-datos-para-entrenar-y-validar">
<a class="anchor" href="#Separar-los-datos-para-entrenar-y-validar" aria-hidden="true"><span class="octicon octicon-link"></span></a>Separar los datos para entrenar y validar<a class="anchor-link" href="#Separar-los-datos-para-entrenar-y-validar"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">X_full</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s1">'object'</span><span class="p">])</span> <span class="c1"># To keep things simple, we'll use only numerical predictors</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test_full</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s1">'object'</span><span class="p">])</span>

<span class="n">train_X</span><span class="p">,</span> <span class="n">val_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">val_y</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="3--Seleccionar-el-modelo">
<a class="anchor" href="#3--Seleccionar-el-modelo" aria-hidden="true"><span class="octicon octicon-link"></span></a>3- Seleccionar el modelo<a class="anchor-link" href="#3--Seleccionar-el-modelo"> </a>
</h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeRegressor</span>  <span class="c1"># RandomForestRegressor</span>

<span class="n">modelo</span> <span class="o">=</span> <span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>    <span class="c1"># escogemos el modelo Árbol de decisión</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="4--Entrenar-el-modelo">
<a class="anchor" href="#4--Entrenar-el-modelo" aria-hidden="true"><span class="octicon octicon-link"></span></a>4- Entrenar el modelo<a class="anchor-link" href="#4--Entrenar-el-modelo"> </a>
</h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">modelo</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">)</span>                      <span class="c1"># se entrena el modelo </span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="5--Evaluar-el-modelo">
<a class="anchor" href="#5--Evaluar-el-modelo" aria-hidden="true"><span class="octicon octicon-link"></span></a>5- Evaluar el modelo<a class="anchor-link" href="#5--Evaluar-el-modelo"> </a>
</h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">val_predicciones</span> <span class="o">=</span> <span class="n">modelo</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">val_X</span><span class="p">)</span>          <span class="c1"># se hace predicción</span>
<span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">val_y</span><span class="p">,</span> <span class="n">val_predicciones</span><span class="p">)</span>      <span class="c1"># se evalua el modelo</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Underfitting-and-Overfitting">
<a class="anchor" href="#Underfitting-and-Overfitting" aria-hidden="true"><span class="octicon octicon-link"></span></a>Underfitting and Overfitting<a class="anchor-link" href="#Underfitting-and-Overfitting"> </a>
</h3>
<ul>
<li>
<em>Underfitting</em>: no encuentra bien patrones relevantes, no predice bien</li>
<li>
<em>Overfitting</em>:  se ajusta demasiado a los datos de entrenamiento, no generaliza bien</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="6--Ajustar-los-parámetros">
<a class="anchor" href="#6--Ajustar-los-par%C3%A1metros" aria-hidden="true"><span class="octicon octicon-link"></span></a>6- Ajustar los parámetros<a class="anchor-link" href="#6--Ajustar-los-par%C3%A1metros"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="7--Generar-la-predicciones">
<a class="anchor" href="#7--Generar-la-predicciones" aria-hidden="true"><span class="octicon octicon-link"></span></a>7- Generar la predicciones<a class="anchor-link" href="#7--Generar-la-predicciones"> </a>
</h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">final_X_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">final_imputer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span>   <span class="c1"># usar total de datos transformados</span>

<span class="c1"># Sacar las predicciones con los datos para test </span>
<span class="n">preds_test</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">final_X_test</span><span class="p">)</span>


<span class="c1"># Guardar datos a archivo</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'Id'</span><span class="p">:</span> <span class="n">X_test</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                       <span class="s1">'SalePrice'</span><span class="p">:</span> <span class="n">preds_test</span><span class="p">})</span>
<span class="n">output</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">'submission.csv'</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Otros-puntos-a-tener-en-cuenta">
<a class="anchor" href="#Otros-puntos-a-tener-en-cuenta" aria-hidden="true"><span class="octicon octicon-link"></span></a>Otros puntos a tener en cuenta<a class="anchor-link" href="#Otros-puntos-a-tener-en-cuenta"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Pipelines-(canalizaciones)">
<a class="anchor" href="#Pipelines-(canalizaciones)" aria-hidden="true"><span class="octicon octicon-link"></span></a>Pipelines (canalizaciones)<a class="anchor-link" href="#Pipelines-(canalizaciones)"> </a>
</h3>
<p>Para agrupar partes de código. Ventajas:</p>
<ul>
<li>Código limpio</li>
<li>Menos errores</li>
<li>Más fácil de llevar a producción</li>
<li>Más opciones para validar el modelo</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="1--Definir-pasos-del-preprocesado">
<a class="anchor" href="#1--Definir-pasos-del-preprocesado" aria-hidden="true"><span class="octicon octicon-link"></span></a>1- Definir pasos del preprocesado<a class="anchor-link" href="#1--Definir-pasos-del-preprocesado"> </a>
</h4>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span>

<span class="c1"># Preprocesamiento de datos numéricos </span>
<span class="n">numerical_transformer</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">'constant'</span><span class="p">)</span>

<span class="c1"># Preprocesamiento de datos categóricos</span>
<span class="n">categorical_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">'imputer'</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">'most_frequent'</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">'onehot'</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s1">'ignore'</span><span class="p">))</span>
<span class="p">])</span>

<span class="c1"># Paquete de prepocesado</span>
<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">'num'</span><span class="p">,</span> <span class="n">numerical_transformer</span><span class="p">,</span> <span class="n">numerical_cols</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">'cat'</span><span class="p">,</span> <span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">categorical_cols</span><span class="p">)</span>
    <span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipykernel_3961/2701167841.py</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">     16</span> preprocessor = ColumnTransformer(
<span class="ansi-green-intense-fg ansi-bold">     17</span>     transformers=[
<span class="ansi-green-fg">---&gt; 18</span><span class="ansi-red-fg">         </span><span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'num'</span><span class="ansi-blue-fg">,</span> numerical_transformer<span class="ansi-blue-fg">,</span> numerical_cols<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">     19</span>         <span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">'cat'</span><span class="ansi-blue-fg">,</span> categorical_transformer<span class="ansi-blue-fg">,</span> categorical_cols<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     20</span>     ])

<span class="ansi-red-fg">NameError</span>: name 'numerical_cols' is not defined</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="2--Definir-modelo">
<a class="anchor" href="#2--Definir-modelo" aria-hidden="true"><span class="octicon octicon-link"></span></a>2- Definir modelo<a class="anchor-link" href="#2--Definir-modelo"> </a>
</h4>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="3--Crear-y-evaluar-el-preprocesado">
<a class="anchor" href="#3--Crear-y-evaluar-el-preprocesado" aria-hidden="true"><span class="octicon octicon-link"></span></a>3- Crear y evaluar el preprocesado<a class="anchor-link" href="#3--Crear-y-evaluar-el-preprocesado"> </a>
</h4>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span>

<span class="c1"># Agrupar código de preprocesamiento y modelado en una canalización </span>
<span class="n">my_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[(</span><span class="s1">'preprocessor'</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
                              <span class="p">(</span><span class="s1">'model'</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
                             <span class="p">])</span>

<span class="c1"># Procesamiento previo de datos de entrenamiento, modelo de ajuste</span>
<span class="n">my_pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1"># Procesamiento previo de datos de validación, obtención de predicciones</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">my_pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_valid</span><span class="p">)</span>

<span class="c1"># Evaluar el modelo</span>
<span class="n">score</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_valid</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'MAE:'</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Validación-cruzada-(Cross-Validation)">
<a class="anchor" href="#Validaci%C3%B3n-cruzada-(Cross-Validation)" aria-hidden="true"><span class="octicon octicon-link"></span></a>Validación cruzada (Cross-Validation)<a class="anchor-link" href="#Validaci%C3%B3n-cruzada-(Cross-Validation)"> </a>
</h3>
<p>Divide los datos en subconjuntos, realiza el entrenamiento y validación alternando los subconjuntos y calcula la media al final.
Para conjuntos de datos grandes es posible que no sea necesario. Si Cross-validation da resultados similares en cada subconjunto no es necesario hacerlo.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>

<span class="n">my_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[(</span><span class="s1">'preprocessor'</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">()),</span>
                              <span class="p">(</span><span class="s1">'model'</span><span class="p">,</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                                                              <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
                             <span class="p">])</span>

<span class="c1"># Multiply by -1 since sklearn calculates *negative* MAE</span>
<span class="n">scores</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">my_pipeline</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
                              <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                              <span class="n">scoring</span><span class="o">=</span><span class="s1">'neg_mean_absolute_error'</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"MAE scores:</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Método-XGBoost">
<a class="anchor" href="#M%C3%A9todo-XGBoost" aria-hidden="true"><span class="octicon octicon-link"></span></a>Método XGBoost<a class="anchor-link" href="#M%C3%A9todo-XGBoost"> </a>
</h3>
<p>Consiste en un ciclo donde se van añadiendo modelos reduciéndose el error paulatinamente.
<br> Usar con datos tabulados, no imagenes o video...</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span>

<span class="n">my_model</span> <span class="o">=</span> <span class="n">XGBRegressor</span><span class="p">()</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="n">predictions</span> <span class="o">=</span> <span class="n">my_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_valid</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Mean Absolute Error: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">y_valid</span><span class="p">)))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>n_estimators</strong> = nº ciclos = nº modelos a añadir. Suele  estar entre 100-1000 (depende mucho del ratio de aprendizaje).
<br></p>
<ul>
<li>muy bajo -&gt; underfitting</li>
<li>muy alto -&gt; overfitting</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>early_stopping_rounds</strong> encuentra automáticamente el valor óptimo de 'n_estimators'. 
Para el entrenamiento cuando el valor de validación deja de mejorar. Valor adecuado=5, para cuando lleva 5 ciclos empeorando la validación.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>learning_rate</strong> = ratio de aprendizaje. Por defecto 0.1.<br>
Por lo general, es mejor nº alto de 'n_estimators' y  bajo de 'learning_rate'</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>n_jobs</strong> = para ejecución en paralelo de grandes conjuntos de datos = nº nucleos del ordenador</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">my_model</span> <span class="o">=</span> <span class="n">XGBRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">my_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> 
             <span class="n">early_stopping_rounds</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> 
             <span class="n">eval_set</span><span class="o">=</span><span class="p">[(</span><span class="n">X_valid</span><span class="p">,</span> <span class="n">y_valid</span><span class="p">)],</span> 
             <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Data-leakage-(fuga-de-datos)">
<a class="anchor" href="#Data-leakage-(fuga-de-datos)" aria-hidden="true"><span class="octicon octicon-link"></span></a>Data leakage (fuga de datos)<a class="anchor-link" href="#Data-leakage-(fuga-de-datos)"> </a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Ocurre cuando el conjunto de datos tiene información de la variable de destino.
Produce alta precisión en el entrenamiento, pero muy baja en la predicciones reales.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Tipos:</p>
<ul>
<li>
<strong>target leakage</strong>: cuando se incluyen datos que tienen información posterior a lo que se desea predecir</li>
<li>
<strong>train-test contamination</strong>: ocurre cuando se mezclan los datos de entrenamiento y los de validación a la hora de entrenar el modelo. </li>
</ul>

</div>
</div>
</div>
</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="juandrh/blog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/blog/python/kaggle/ml/2021/08/16/Machine-Learning-con-Python.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/blog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/blog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Aprendiendo Inteligencia Artificial a los 50.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/juandrh" title="juandrh"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/juandrh2_0" title="juandrh2_0"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
